# ì‹±ê¸€í„´(Singleton)

## ì‹±ê¸€í„´ íŒ¨í„´ì´ë€

- ì „ì—­ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  ê°ì²´ë¥¼ í•˜ë‚˜ë§Œ ìƒì„±í•˜ë„ë¡ í•˜ë©°, ìƒì„±ëœ ê°ì²´ë¥¼ ì–´ë””ì—ì„œë“ ì§€ ì°¸ì¡°í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” íŒ¨í„´

| í´ë˜ìŠ¤ | Singleton |
| --- | --- |
| í•„ë“œ | -instance |
| ë©”ì„œë“œ | -Singleton() |
| ë©”ì„œë“œ | +getInstance() |

## ì˜ˆì‹œ: í”„ë¦°í„° ê´€ë¦¬ì ë§Œë“¤ê¸°

- í”„ë¦°í„°ê¸° í•˜ë‚˜ë¥¼ 10ëª…ì´ ê³µìœ í•´ì„œ ì‚¬ìš©í•œë‹¤ê³  í•˜ì

```java
public class Printer {
	public Printer() {}
	public void print(String str) { ... }
}
```

- ê·¸ëŸ¬ë‚˜ Printer í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•´ í”„ë¦°í„°ë¥¼ ì´ìš©í•˜ë ¤ë©´ í´ë¼ì´ì–¸íŠ¸ í”„ë¡œê·¸ë¨ì—ì„œ new Printer( )ê°€ ë°˜ë“œì‹œ í•œ ë²ˆë§Œ í˜¸ì¶œë˜ë„ë¡ ì£¼ì˜í•´ì•¼ í•œë‹¤ (í”„ë¦°í„°ê¸°ëŠ” í•˜ë‚˜ì´ê¸° ë•Œë¬¸ì—)
- ì´ë¥¼ í•´ê²°í•˜ëŠ” ë°©ë²•ì€ ìƒì„±ìë¥¼ ì™¸ë¶€ì—ì„œ í˜¸ì¶œí•  ìˆ˜ ì—†ê²Œ í•˜ëŠ” ê²ƒì´ë‹¤
    - Printer í´ë˜ìŠ¤ì˜ ìƒì„±ìë¥¼ privateìœ¼ë¡œ ì„ ì–¸
    
    ```java
    public class Printer {
    	private Printer() {} // ìƒì„±ìëŠ” ì™¸ë¶€ì—ì„œ ì‚¬ìš© ë¶ˆê°€
    	public void print(String str) { ... }
    }
    ```
    

- ìê¸° ìì‹ ì˜ í”„ë¦°í„°ì— ëŒ€í•œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ í•˜ë‚˜ ë§Œë“¤ì–´ ì™¸ë¶€ì— ì œê³µí•´ì¤„ ë©”ì„œë“œê°€ í•„ìš”í•˜ë‹¤
    
    ```java
    public class Printer {
    	// ì™¸ë¶€ì— ì œê³µí•  ìì‹ ì˜ ì¸ìŠ¤í„´ìŠ¤
    	private static Printer printer = null;
    	private Printer() {} // ìƒì„±ìëŠ” ì™¸ë¶€ì—ì„œ ì‚¬ìš© ë¶ˆê°€
    	
    	// ìì‹ ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì™¸ë¶€ì— ì œê³µ
    	public static Printer getPrinter() {
    		if(printer == null) {
    			printer = new Printer();
    		}
    		return printer;
    	}
    
    	public void print(String str) { ... }
    }
    ```
    

- í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì‚¬ìš©

```java
public class User {
	private String name;
	public User(String name) { this.name = name; }
	public void print() {
		Printer printer = printer.getPrinter(); // ì‚¬ìš©ì‹œ Printer ì¸ìŠ¤í„´ìŠ¤ í˜¸ì¶œ
		printer.print(this.name + " print using " + printer.toString());
	}
}

public class Client {
	private static final int USER_NUM = 5;
	public static void main(String[] args) {
		User[] user = new User[USER_NUM];
		for(int i=0; i<USER_NUM; i++) {
			user[i] = new User(String.valueOf(i+1));
			user[i].print(); // Printer í˜¸ì¶œí•´ì„œ ì‚¬ìš©
		}
	}
}
```

## ë¬¸ì œì 

ë©€í‹°ìŠ¤ë ˆë“œì—ì„œ Printer í´ë˜ìŠ¤ë¥¼ ì´ìš©í•  ë•Œ ì¸ìŠ¤í„´ìŠ¤ê°€ 1ê°œ ì´ìƒ ìƒì„±ë˜ëŠ” ê²½ìš°ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤

- ê²½í•© ì¡°ê±´(Race Condition)ì„ ë°œìƒì‹œí‚¤ëŠ” ê²½ìš°
    1. Printer ì¸ìŠ¤í„´ìŠ¤ê°€ ì•„ì§ ìƒì„±ë˜ì§€ ì•Šì•˜ì„ ë•Œ ìŠ¤ë ˆë“œ 1ì´ getPrinter ë©”ì„œë“œì˜ ifë¬¸ì„ ì‹¤í–‰í•´ ì´ë¯¸ ì¸ìŠ¤í„´ìŠ¤ê°€ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸í•œë‹¤
    2. ë§Œì•½ ìŠ¤ë ˆë“œ 1ì´ ìƒì„±ìë¥¼ í˜¸ì¶œí•´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“¤ê¸° ì „ ìŠ¤ë ˆë“œ 2ê°€ ifë¬¸ì„ ì‹¤í–‰í•´ printerê°€ nullì¸ì§€ í™•ì¸í•œë‹¤. í˜„ì¬ printerëŠ” nullì´ë¯€ë¡œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ëŠ” ìƒì„±ìë¥¼ í˜¸ì¶œí•˜ê²Œ ëœë‹¤
    3. ìŠ¤ë ˆë“œ 1ë„ ìŠ¤ë ˆë“œ 2ì™€ ë§ˆì°¬ê°€ì§€ë¡œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ëŠ” ì½”ë“œë¥¼ ì‹¤í–‰í•˜ê²Œ ë˜ë©´ ê²°ê³¼ì ìœ¼ë¡œ Printer í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ê°€ 2ê°œ ìƒì„±ëœë‹¤
- ê²½í•© ì¡°ê±´ì´ë€?
    - ë©”ëª¨ë¦¬ì™€ ê°™ì€ ë™ì¼í•œ ìì›ì„ 2ê°œ ì´ìƒì˜ ìŠ¤ë ˆë“œê°€ ì´ìš©í•˜ë ¤ê³  ê²½í•©í•˜ëŠ” í˜„ìƒ
- ìŠ¤ë ˆë“œ ìŠ¤ì¼€ì¤„ë§ì„ ê³ ì˜ë¡œ ë³€ê²½í•˜ì—¬ ê²½í•© ì¡°ê±´ì„ ë§Œë“¤ì–´ë³´ì

```java
public class Printer {
	// ì™¸ë¶€ì— ì œê³µí•  ìì‹ ì˜ ì¸ìŠ¤í„´ìŠ¤
	private static Printer printer = null;
	private Printer() {} // ìƒì„±ìëŠ” ì™¸ë¶€ì—ì„œ ì‚¬ìš© ë¶ˆê°€
	
	// ìì‹ ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì™¸ë¶€ì— ì œê³µ
	public static Printer getPrinter() {
		if(printer == null) { // ì¡°ê±´ ê²€ì‚¬ êµ¬ë¬¸ (ë¬¸ì œì˜ ì›ì¸)
			try {
				Thread.sleep(1); // ìŠ¤ë ˆë“œ ìŠ¤ì¼€ì¤„ë§ ë³€ê²½(ìŠ¤ë ˆë“œ ì‹¤í–‰ 1msê°„ ì •ì§€)
			} catch (InterruptedException e) {
				e.printStackTrace();
			}
			printer = new Printer();
		}
		return printer;
	}

	public void print(String str) { ... }
}
```

```java
public class UserThread extends Thread {
	public UserThread(String name) { super(name); }
	public void run() {
		Printer printer = printer.getPrinter();
		printer.print(Thread.currentThread().getName() + " print using " + printer.toString());
	}
}

public class Client {
	private static final int USER_NUM = 5;
	public static void main(String[] args) {
		UserThread[] user = new UserThread[USER_NUM];
		for(int i=0; i<USER_NUM; i++) {
			user[i] = new UserThread(String.valueOf(i+1));
			user[i].run();
		}
	}
}
```

## í•´ê²°ì±…

í”„ë¦°í„° ê´€ë¦¬ì(Lazy Initialization)ëŠ” ì‚¬ì‹¤ ë©€í‹°ìŠ¤ë ˆë“œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ì•„ë‹Œ ê²½ìš°ì—ëŠ” ë¬¸ì œê°€ ë˜ì§€ ì•ŠëŠ”ë‹¤

- ë©€í‹°ìŠ¤ë ˆë“œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë°œìƒí•˜ëŠ” ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ë°©ë²•
    - ì •ì  ë³€ìˆ˜ì— ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“¤ì–´ ë°”ë¡œ ì´ˆê¸°í™”í•˜ëŠ” ë°©ë²•(Eager Initialization)
    - ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“œëŠ” ë©”ì„œë“œì— ë™ê¸°í™”í•˜ëŠ” ë°©ë²•(Thread-Safe Initialization)
    
- ì •ì  ë³€ìˆ˜ì— ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“¤ì–´ ë°”ë¡œ ì´ˆê¸°í™”í•˜ëŠ” ë°©ë²•

```java
public class Printer {
	// static ë³€ìˆ˜ì— ì™¸ë¶€ì— ì œê³µí•  ìê¸° ìì‹ ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“¤ì–´ ì´ˆê¸°í™”
	private static Printer printer = new Printer();
	private Printer() {}
	public static Printer getPrinter() {
		return printer;
	}

	public void print(String str) { ... }
}
```

<aside>
ğŸ’¡ static ë³€ìˆ˜ëŠ” ì¸ìŠ¤í„´ìŠ¤ê°€ ìƒì„±ë˜ê¸° ì „, í´ë˜ìŠ¤ê°€ ë©”ëª¨ë¦¬ì— ë¡œë”©ë  ë•Œ ë§Œë“¤ì–´ì ¸ ì´ˆê¸°í™”ê°€ í•œ ë²ˆë§Œ ì‹¤í–‰ëœë‹¤. í”„ë¡œê·¸ë¨ ì‹œì‘ ~ ì¢…ë£Œê¹Œì§€ ì—†ì–´ì§€ì§€ ì•Šê³  ë©”ëª¨ë¦¬ì— ê³„ì† ìƒì£¼í•˜ë©° í´ë˜ìŠ¤ì—ì„œ ìƒì„±ëœ ëª¨ë“  ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ì°¸ì¡°í•  ìˆ˜ ìˆë‹¤.

</aside>

- ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“œëŠ” ë©”ì„œë“œì— ë™ê¸°í™”ë˜ëŠ” ë°©ë²•

```java
public class Printer {
	private static Printer printer = null;
	private int counter = 0;
	private Printer() {}
	// ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ëŠ” ë©”ì„œë“œ ë™ê¸°í™”í•œë‹¤
	public synchronized static Printer getPrinter() {
		if(printer == null) {
			printer = new Printer();
		}
		return printer;
	}

	public void print(String str) {
		// í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œë§Œ ì ‘ê·¼ì„ í—ˆìš©í•œë‹¤
		synchronized(this) {
			counter++;
			Sysmter.out.println(str + counter);
		}
	}
}
```

- ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“œëŠ” ë©”ì„œë“œë¥¼ ì„ê³„ êµ¬ì—­(Critical Section)ìœ¼ë¡œ ë³€ê²½
    - ë©€í‹°ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ ë™ì‹œì— ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ getPrinter( )ë¥¼ ì†Œìœ í•˜ëŠ” ê°ì²´ì— ì ‘ê·¼í•˜ëŠ” ê²ƒì„ ë°©ì§€í•œë‹¤
- ê³µìœ  ë³€ìˆ˜ì— ì ‘ê·¼í•˜ëŠ” ë¶€ë¶„ì„ ì„ê³„ êµ¬ì—­ìœ¼ë¡œ ë³€ê²½
    - ì—¬ëŸ¬ ê°œì˜ ìŠ¤ë ˆë“œê°€ í•˜ë‚˜ ë¿ì¸ counter ë³€ìˆ˜ ê°’ì— ë™ì‹œì— ì ‘ê·¼í•´ ê°±ì‹ í•˜ëŠ” ê²ƒì„ ë°©ì§€í•œë‹¤
- getInstance( )ì— Lockì„ í•˜ëŠ” ë°©ì‹ì´ë¼ ì†ë„ê°€ ëŠë¦¬ë‹¤

## ì •ì  í´ë˜ìŠ¤

ì •ì  ë©”ì„œë“œë¡œë§Œ ì´ë£¨ì–´ì§„ ì •ì  í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë©´ ì‹±ê¸€í„´ê³¼ ë™ì¼í•œ íš¨ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤

```java
public class Printer {
	private static int counter = 0;
	
	public synchronized static void print(String str) {
		counter++;
		System.out.println(str + counter);
	}
}
```

```java
public class UserThread extends Thread {
	public UserThread(String name) { super(name); }
	public void run() {
		Printer.print(Thread.currentThread().getName())0;
	}
}

public class Client {
	private static final int USER_NUM = 5;
	public static void main(String[] args) {
		UserThread[] user = new UserThread[USER_NUM];
		for(int i=0; i<USER_NUM; i++) {
			user[i] = new UserThread(String.valueOf(i+1));
			user[i].run();
		}
	}
}
```

- ì°¨ì´ì 
    - ì •ì  í´ë˜ìŠ¤ë¥¼ ì´ìš©í•˜ë©´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ì§€ ì•Šê³  ë©”ì„œë“œë¥¼ ì‚¬ìš©í•œë‹¤
    - ì •ì  ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ ì¼ë°˜ì ìœ¼ë¡œ ì‹¤í–‰ë  ë•Œ (ì»´íŒŒì¼íƒ€ì„ì—) ë°”ì¸ë”©ë˜ëŠ” ì¸ìŠ¤í„´ìŠ¤ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒë³´ë‹¤ ì„±ëŠ¥ ë©´ì—ì„œ ìš°ìˆ˜í•˜ë‹¤
- ì •ì  í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ê²½ìš°
    - ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•´ì•¼ í•˜ëŠ” ê²½ìš°, ì •ì  ë©”ì„œë“œëŠ” ì¸í„°í˜ì´ìŠ¤ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤
- ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ 
    - ëŒ€ì²´ êµ¬í˜„ì´ í•„ìš”í•œ ê²½ìš°
    - ì˜ˆë¥¼ ë“¤ì–´ Mock ê°ì²´ë¥¼ ì‚¬ìš©í•´ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ëŠ” ê²½ìš°

## Enum í´ë˜ìŠ¤

```java
public enum Singleton {
	INSTANCE;

	public static Singleton getInstance() {
		return INSTANCE;
	}
}
```

- Enumì„ ì´ìš©í•´ì„œ Singletonì„ êµ¬í˜„í•˜ëŠ” ê²ƒì´ ê°€ì¥ ì¢‹ì€ ë°©ë²•ì´ë‹¤
    - Thread-Safetyì™€ Serializationì´ ë³´ì¥ëœë‹¤
    - Reflectionì„ í†µí•œ ê³µê²©ì—ë„ ì•ˆì „í•˜ë‹¤