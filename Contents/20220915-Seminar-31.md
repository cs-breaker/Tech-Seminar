# 로드밸런싱

작성자 : 박성민

작성일 : 2022-09-16

---

## 로드 밸런싱이란?

- 부하분산 또는 로드 밸런싱은 컴퓨터 네트워크 기술의 일종으로 둘 혹은 셋이상의 중앙처리장치 혹은 저장장치와 같은 컴퓨터 자원들에게 작업을 나누는것을 의미한다.
  즉 여러 서버가 분산 처리 하는것을 로드 밸런싱이라고 한다.
- 그럼 로드밸런서는??
  - 로드밸런싱 기술을 제공하는 서비스 또는 장치를 말한다.

## 로드 밸런싱이 왜 필요할까?

- 서버가 한대만 존재한다면 많은 사람들이 동시에 접속할 때 그 부하를 감당하지 못할 수가 있다. 이를 해결하는 방식에는 장비를 업그레이드하는 **Scale-up**방식과 장비를 여러개 두는 **Scale-out**방식이 있다.
- Scale-out 방식을 사용한다면 해당 서비스에 접근하기 위해서는 서버마다 존재하는 다른 IP가 필요하다. 하지만 서버마다 다른 IP를 부여한다면 사용자들마다 각각 다른 IP로 접속할 것이고, 개발자가 원하는 방식대로 부하를 분산하기 어려워진다.
- 이를 방지하기 위해 서버를 분산하고 가해지는 부하를 적절하게 분산하는 작업이 필요하다. 이렇게 두 개 이상의 컴퓨터 자원에 작업을 나누는 것을 **로드밸런싱**이라고 한다.

## 로드 밸런싱의 종류

L2, L3, L4, L7이 있는데 주로 사용되는 것은 L4와 L7 로드밸런싱이다.

OSI 7계층을 다음 글을 참고하자.

[Tech-Seminar/20220825-Seminar-25.md at main · cs-breaker/Tech-Seminar](https://github.com/cs-breaker/Tech-Seminar/blob/main/Contents/20220825-Seminar-25.md)

### L4 Switch

- Transport 계층을 사용. Port 기반 부하 분산
- 단순 라우터만 이용하는 것이 아니라, TCP/IP 프로토콜을 사용한다.
- 주로 Round Robin 방식을 이용한다.
- Port 구분이 가능하기에 프로토콜(HTTP, FTP)마다 다른 서버로 보내도록 설정이 가능하다.
- 실제 IP들을 하나의 가상IP(Virtual IP, VIP)로 묶어서 처리할 수 있다. 그래서 아래와 같은 작업이 가능하다.
  - VIP를 통해 요청받은 작업을 여러개의 서버로 분산시킬 수 있음.
  - VIP를 통해 연결된 서버가 다운되어도 자동으로 다른 서버가 해당역할을 하도록 전환하는 Failover 기능지원.

### L7 Switch

- Application 계층을 사용. HTTP Request 요청 내용까지 판단하여 로드밸런싱한다.
- L4가 사용하는 IP + Port 뿐만아니라, URI정보, 쿠키등을 다 판단해 유연하게 네트워크 밸런싱을 할 수 있다.
  ex1) L4 Switch에서 제공하는 기능을 다 포함한다. 프로토콜(Port)별로 다른 서버에 할당 가능하다.
  ex2) [www.naver.com/blog와](http://www.naver.com/blog와) [www.naver.com/cafe](http://www.naver.com/cafe) 를 다른 서버가 처리하도록 설정할 수 있다.
  ex3) URI, 쿠키, 바이러스 패턴등을 분석해 특정 트래픽을 받지 않도록 필터링 할 수 있다.
  ex4) 패킷의 데이터부문, Payload를 분석하여 DDOS 같은 서비스 공격을 완화 할 수 있다.

```
회사에서 공유기(사설IP)를 사용하는 경우 -> 한 회사의 모든 요청 IP가 똑같다.
- L4 스위치는 모든 요청을 한 서버에 할당한다. IP+Port가 같으니까
- L7 스위치는 IP+Port뿐만 아니라 HTTP Request를 이용해 분산시키므로, 적절하게 분산 가능하다.
```

- L7이 L4에 비해 분석해야할 정보가 많아 로드밸런싱 작업이 어렵고 무거워진다.

## Load Balancing algorithm 종류

### 라운드 로빈 방식

클라이언트로부터 받은 요청을 로드밸런싱 대상 서버에 순서대로 할당하는 방식이다. 첫 번째 요청은 첫 번째 서버, 두 번째 요청은 두 번째 서버, 세 번째 요청은 세 번째 서버에 할당한다. 로드밸런싱 대상 서버의 성능이 동일하고 처리 시간이 짧은 애플리케이션의 경우, 균등하게 분산이 이루어지기 때문에 이 방식을 사용한다.

### 가중 라운드 로빈 방식

실제 서버에 서로 다른 처리 용량을 지정할 수 있다. 각 서버에 가중치를 부여할 수 있으며, 여기서 지정한 정숫값을 통해 처리 용량을 정한다.

### 최소 연결 방식

연결 수가 가장 적은 서버에 네트워크 연결방향을 정한다. 동적인 분산 알고리즘으로 각 서버에 대한 현재 연결 수를 동적으로 카운트할 수 있고, 동적으로 변하는 요청에 대한 부하를 분산시킬 수 있다.

참고

[https://dev.classmethod.jp/articles/load-balancing-types-and-algorithm/](https://dev.classmethod.jp/articles/load-balancing-types-and-algorithm/)

[https://deveric.tistory.com/91](https://deveric.tistory.com/91)

[https://jiwondev.tistory.com/189](https://jiwondev.tistory.com/189)
