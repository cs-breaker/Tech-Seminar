# CPU 스케쥴러

## 프로세스 스케쥴링을 위한 자료구조

### Job Queue

상태에 상관없이 모든 프로세스를 저장하고, 관리하기 위한 자료구조

반드시 메모리가 할당되어 있는 프로세스만 있지않고, 모든 프로세스가 담겨있다.

### Ready Queue

Ready 상태(프로세스가 CPU의 할당을 기다리는 상태로 할당만 된다면 바로 실행할 수 있는 대기상태)의 프로세스들을 관리하기 위한 자료구조

프로세스들에게 CPU를 어떻게 할당할지? 에 대한 스케쥴링 알고리즘이 존재한다.

Job Queue와 달리 Ready Queue의 프로세스들은 모두 메모리가 할당된 상태이다.

### Device Queue

각각의 장치마다 사용되기를 기다리며, 줄 서 있는 프로세스들을 관리하기 위한 자료구조

Device Queue에 속한 프로세스는 Blocked 상태가 된다. Blocked 상태에 있다가, 장치 컨트롤러가 인터럽트를 발생시키면 Ready 상태가 되며, Ready Queue로 이동한다.

## 스케쥴러란?

### 장기 스케줄러 (Job Scheduler)

어떤 프로세스를 Ready Queue에 넣어줄 것인가?(=어떤 프로세스에 메모리를 할당할 것인가?)를 결정하는 스케쥴러.

프로세스의 상태를 new 에서 ready 상태로 바꿔주는 역할을 함

디스크와 메모리 사이의 스케줄링을 담당하는 부분임

결과적으로 ‘실행중인 프로세스 개수’를 제어하는 부분

현대의 운영체제에서는 사용하지 않음 → 요즘은 운영체제가 가상 메모리를 지원하기 때문에 메모리 제한이 없어졌기 때문

### 단기 스케쥴러 (CPU Scheduler)

일반적으로 스케쥴러라고 부르는 것은 단기 스케쥴러임

레디큐에 있는 프로세스 중 어떤 프로세스에 CPU를 할당할지를 결정함

CPU와 메모리 사이를 스케쥴링

매우 빈번하기 호출되므로 속도가 적당히 빨라야 함

ready → running → waiting → ready의 상태를 관리함

ready queue에 있던 프로세스를 running상태로 바꾸고, I/O 처리를 위해 waiting queue로 가기도 하는데, 이때 CPU가 낭비되지 않도록 다른 프로세스에 CPU를 할당해주게 된다.

## 스케쥴링의 우선순위 기준

1. 대기시간
2. CPU 할당시간
3. 등등

## 스케쥴링의 목표

1. CPU 활용의 최대화
2. 평균 대기 시간의 최소화
3. 처리량의 최소화

스케줄링은 멀티 프로세싱 운영 체제를 디자인하는 일과 컴퓨터의 멀티태스킹 작업을 만들어내는 것에 있어서 핵심 개념이다.

## 스케줄링 알고리즘

### FCFS (First Come First Served)

큐처럼 먼저 들어온 프로세스에게 먼저 CPU를 할당

구현할 때에는 FIFO 큐 자료구조를 사용한다.

비선점 스케쥴링 알고리즘 → 콘보이 효과를 불러옴

먼저 할당된 프로세스의 처리가 끝날 때 까지, 다음 프로세스는 CPU를 할당받을 수 없다.

먼저 들어온 프로세스가 시간 소요가 큰 프로세스면, 비효율적인 결과를 초례함

- 콘보이 효과
    
    CPU를 매우 오래 사용하는 프로세스가 도착하게 되면, 다른 프로세스가 CPU를 사용하는데 기다리는 대기시간이 매우 길어지는 현상을 말한다.
    

### SJF (Short - Job - First)

도착 순서와 관계없이, CPU Burst Time이 짧은 프로세스에게 먼저 할당하는 방식

선점 스케쥴링 알고리즘, 비선점 스케쥴링 알고리즘 두 가지 종류가 있음

최소의 평균 대기시간을 위해 최적화된 알고리즘

FCFS에 비해서 효율적으로 CPU를 사용하는 것 같지만, 결국 Burst Time이 긴 프로세스는 영원이 CPU를 할당받을 수 없게 된다.

### SRTF (Shortest Remaining Time First)

새로운 프로세스가 들어올 때마다 새롭게 스케쥴링을 하는 것

SFJ를 유지하다가, 그보다 더짧은 프로세스가 들어오면 중단하고 새로 들어온 더 짧은 프로세스에게 CPU를 할당

새로운 프로세스가 도달할 때마다, 스케줄링을 다시 하기 때문에, CPU Burst Time을 측정할 수 없게된다.

### Priority Scheduling

우선순위 큐처럼 우선순위를 주고, 우선순위에 따라 CPU를 할당받는 방식

우선순위가 더 높은 프로세스가 들어오면 CPU를 그 쪽으로 할당하도록 되어있음

우선순위가 낮은 프로세스는 무기한 대기할 수 있다는 문제가 있음

이를 해결하기 위한 방법은 Aging-Method가 있음

- Aging-Method
    
    레디 큐에서 우선순위가 낮아 오래 기다린 프로세스의 우선순위를 계속해서 높히게 하는 기법
    

### Round Robin (RR)

가장 현대적인 스케쥴링 방식으로 Context Switching이 이 방식으로 이뤄진다.

각 프로세스마다 동일한 할당시간을 분배하고, 그 할당시간이 끝나면, 다시 Ready Queue에 끝으로 가서 대기를 해야함

랜덤한 프로세스들이 공정하게 CPU할당을 받고 처리될 수 있따.

만약 할당시간이 지나치게 커지면, FCFS와 똑같아지고, 할당시간이 작으면 Context-Switching이 빈번해져 Overhead가 발생할 수 있다.